{% extends "site_base.html" %}
{% load static from staticfiles %}
{% load i18n %}

{% block title %}{% trans "Explore Expenses" %}{% endblock %}

{% block static %}
    <!-- PAGE LEVEL SCRIPTS -->

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css"
          rel="stylesheet" type="text/css" />

    <!-- Include jTable style and jTable script. -->
    <link href="{% static "plugins/jtable/themes/metro/green/jtable.min.css" %}" rel="stylesheet" type="text/css" />
    <script src="{% static "plugins/jtable/jquery.jtable.min.js" %}" type="text/javascript"></script>

	<link href="{% static "css/plugin-hover-buttons.css" %}" rel="stylesheet" type="text/css" />
    <link href="{% static "css/header-1.css" %}" rel="stylesheet" type="text/css" />
    <link href="{% static "css/color_scheme/green.css" %}" rel="stylesheet" type="text/css" id="color_scheme" />

    <script>
    function showHide(){
        $("#selectFilters").toggle();
    }
    function clearFilter(){
        $("#frDate").val('');
        $("#toDate").val('');
        $("#frAmount").val('');
        $("#toAmount").val('');
        $("#inCategory").val('');
        $("#inNote").val('');
        $('#buttonFilter').removeClass('btn-amber').addClass('btn-default');
        showHide();
        $("#LoadRecordsButton").click();
    }
    $(function() {
        $( "#frDate" ).datepicker({
            dateFormat: 'yy-mm-dd'
        });
        $( "#toDate" ).datepicker({
            dateFormat: 'yy-mm-dd'
        });
    });
    </script>

    <style>
        table, th, td {
            border-collapse: collapse;
        }
        th, td {
            padding: 5px;
            text-align: left;
        }
    </style>

{% endblock %}

{% block body_classes %} bg-grey {% endblock %}

{% block body_container %}

    {% include "./menu.html" %}

    <div class="col-md-8 col-md-offset-2">

            <div class="margin-top-30 margin-bottom-30 box-static box-transparent box-bordered box-white">

                <h2>{% trans page_title %}</h2>

                <button class='btn btn-default' id="buttonFilter" name="buttonFilter"
                        onclick="showHide();">Hide/Show Filter</button>

                <form class="margin-top-0 sky-form centered" id="formFilter" name="formFilter">

                    <div id="selectFilters" name="selectFilters" style="display:none;">

                        <div class="box-static box-transparent box-bordered">
                            <table style="border-spacing: 5px;">
                                <tr>
                                    <td>From Date:</td><td><input type="date" name="frDate" id="frDate" /></td>
                                    <td>To Date:</td><td><input type="date" name="toDate" id="toDate" /></td>
                                    <td rowspan="3" width="20%">
                                        To filter by a specific date or amount, enter something for "from" and leave
                                        "to" empty. Filters for category and notes are not case sensitive.
                                    </td>
                                </tr>
                                <tr>
                                    <td>From Amount:</td><td><input type="number" name="frAmount" id="frAmount" /></td>
                                    <td>To Amount:</td><td><input type="number" name="toAmount" id="toAmount" /></td>
                                </tr>
                                <tr>
                                    <td>Category Contains:</td><td><input type="text" name="inCategory" id="inCategory" /></td>
                                    <td>Note Contains:</td><td><input type="text" name="inNote" id="inNote" /></td>
                                </tr>
                                <tr>
                                    <td colspan="4">
                                        <button class='btn btn-amber' type="submit" id="LoadRecordsButton"
                                            name="LoadRecordsButton">Filter</button>
                                        <button class='btn btn-aqua' id='clearFilter' name='clearFilter'
                                            onclick='clearFilter();'>Reset</button>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </form>
                <div id="Explore_Expenses_Container"></div>
            </div>
    </div>

{% endblock %}

{% block scripts %}

    <script type="text/javascript">

    $(document).ready(function () {
        $.ajaxSetup({beforeSend: function(xhr, settings){
            xhr.setRequestHeader('X-CSRFToken',
                         '{{ csrf_token }}');
        }});
        $('#Explore_Expenses_Container').jtable({
            title: '',
            paging: true,
            actions: {
                listAction: '/capture/ajax/list_expenses/',
                createAction: '',
                updateAction: '/capture/ajax/change_expense/u/',
                deleteAction: '/capture/ajax/change_expense/d/'
            },
            fields: {
                id: {
                    key: true,
                    create: false,
                    edit: false,
                    list: false
                },
                expense_date: {
                    title: 'Date',
                    type: 'date',
                    width: '15%'
                },
                amount: {
                    title: 'Amount',
                    type: 'number',
                    width: '10%'
                },
                category:{
                    title: 'Category',
                    width: '25%',
                    edit: false
                },
                note: {
                    title: 'Note',
                    type: 'textarea',
                    width: '50%'
                }
            },
            //Validate form when it is being submitted
            formSubmitting: function (event, data) {
                var ok = true;
                var message = '';
                var $temp = '';

                $temp = $('input[name="amount"]').val();
                if ($temp == ''){
                    ok = false;
                    message += 'Amount must be greater than zero.\n';
                }

                if (message) {
                    alert(message);
                }
                return ok;
            },
            //Conditionally show edit and delete buttons
            rowInserted: function(event, data){
              if (data.record.amount == 0){
                //data.row.find('.jtable-edit-command-button').hide();
                //data.row.find('.jtable-delete-command-button').hide();
              }
            },
            recordUpdated: function (event, data) {
                $('#Explore_Expenses_Container').jtable('reload')
            }
        });
        //Re-load records when user clicks 'load records' button.
        $('#LoadRecordsButton').click(function (e) {
            e.preventDefault();
            $('#buttonFilter').removeClass('btn-default').addClass('btn-amber');
            showHide();
            $('#Explore_Expenses_Container').jtable('load', {
                frDate: $('#frDate').val(),
                toDate: $('#toDate').val(),
                frAmount: $('#frAmount').val(),
                toAmount: $('#toAmount').val(),
                inCategory: $('#inCategory').val(),
                inNote: $('#inNote').val()
            });
        });
        $('#Explore_Expenses_Container').jtable('load');
    });

    </script>

{% endblock %}